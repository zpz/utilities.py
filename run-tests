#!/bin/bash

set -e

PYVER=3.8

docker build \
    --build-arg PYTHON_VERSION=${PYVER} \
    --target test \
    -t zpz-test:latest \
    .

if [ "$#" -gt 0 ]; then
    # Run one specific test file.
    docker run \
        zpz-test:latest \
        py.test \
            -s \
            --flake8 \
            --mypy \
            --log-cli-level info \
            /opt/zpz/tests/$@
else
    # Run all tests.
    docker run \
        zpz-test:latest \
        py.test \
            --flake8 \
            --mypy \
            --log-cli-level warning \
            --cov=/usr/local/lib/python${PYVER}/site-packages/zpz \
            --cov-fail-under 35 \
            /opt/zpz/tests
fi

