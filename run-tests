#!/bin/bash

# This builds Docker image, starts a container,
# and lands in it for interactive tests.

set -e

# Infer package name:
rm -rf src/*egg-info
proj="$(ls src/)"
if [[ $proj = *' '* ]]; then
    >&2 echo "unable to infer project name"
    exit 1
fi
PROJ=${proj%/}

docker build \
    -f Dockerfile \
    --build-arg PROJ=${PROJ} \
    -t ${PROJ}-dev:latest \
    .

docker run \
    -it --rm \
    -v $(pwd):/src \
    --workdir /src \
    -e PYTHONPATH=/src/src \
    -e IMAGE_NAME=${PROJ} \
    ${PROJ}-dev:latest \
    bash
